<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Obras - PI</title>
    <link rel="icon" href="icones/icones_menu/dados_pi.png" type="image/png">
    
    <link rel="stylesheet" href="css/layout.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slim-select/1.27.1/slimselect.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slim-select/1.27.1/slimselect.min.js"></script>
</head>
<body>

    <header class="topbar">
        <div class="topbar-left">
            <button id="menu-toggle" class="btn-menu">
                <img src="icones/icones_menu/legenda.svg" alt="Menu">
            </button>
        </div>

        <div class="topbar-right">
            <img src="icones/icones_menu/logo_pi.png" alt="Piau√≠" class="logo-estado">
        </div>
    </header>

    <div class="main-container">
        
        <div id="sidebar-container" class="sidebar-container closed">
            
            <aside class="icon-bar">
                <div class="icon-item active" data-target="panel-obras" title="Obras">
                    <img src="icones/icones_menu/obras.png" alt="Obras">
                </div>
                <div class="icon-item" data-target="panel-filtros" title="Filtros">
                    <img src="icones/icones_menu/filtro.png" alt="Filtros">
                </div>
                <div class="icon-item" data-target="panel-legendas" title="Legendas">
                    <img src="icones/icones_menu/legendas.png" alt="Legendas">
                </div>
                <div class="icon-item" data-target="panel-sobre" title="Sobre">
                    <img src="icones/icones_menu/informacao.png" alt="Sobre">
                </div>
            </aside>

            <div class="content-panel">
                
                <div id="panel-obras" class="panel-section active">
                    <h3>Detalhes da Obra</h3>
                    <div id="conteudo-detalhes">
                        <p class="placeholder-text">Selecione uma obra no mapa ou clique em "Mais Informa√ß√µes" no popup para ver os detalhes completos aqui.</p>
                    </div>
                </div>

                <div id="panel-filtros" class="panel-section">
                    <h3>Filtros de Pesquisa</h3>
                    
                    <form id="form-filtros" onsubmit="event.preventDefault();">
                        
                        <div class="filter-group">
                            <label>Munic√≠pio</label>
                            <select id="filtro-municipio" multiple></select>
                        </div>

                        <div class="filter-group">
                            <label>Territ√≥rio</label>
                            <select id="filtro-territorio" multiple></select>
                        </div>

                        <div class="filter-group">
                            <label>Eixo</label>
                            <select id="filtro-eixo" multiple></select>
                        </div>

                        <div class="filter-group">
                            <label>√ìrg√£o</label>
                            <select id="filtro-orgao" multiple></select>
                        </div>

                        <div class="filter-group">
                            <label>Situa√ß√£o</label>
                            <select id="filtro-situacao" multiple></select>
                        </div>

                        <div class="filter-group">
                            <label>Classifica√ß√£o</label>
                            <select id="filtro-classificacao" multiple></select>
                        </div>

                        <div class="filter-group">
                            <label>Sub-Classifica√ß√£o</label>
                            <select id="filtro-subclassificacao" multiple></select>
                        </div>

                        <div class="filter-group">
                            <label>Tipologia</label>
                            <select id="filtro-tipologia" multiple></select>
                        </div>

                        <div class="filter-actions">
                            <button type="button" class="btn-limpar" onclick="limparFiltros()">Limpar</button>
                            <button type="button" class="btn-aplicar" onclick="aplicarFiltros()">Filtrar</button>
                        </div>

                    </form>
                </div>

                <div id="panel-legendas" class="panel-section">
                    <h3>Legendas</h3>

                    <div class="legenda-grupo">
                        <h4>SITUA√á√ÉO</h4>
                        <div class="legenda-item">
                            <img src="icones/icones_legendas/concluido.png" alt="Conclu√≠do">
                            <span>Conclu√≠do</span>
                        </div>
                        <div class="legenda-item">
                            <img src="icones/icones_legendas/em_desenvolvimento.png" alt="Em Desenvolvimento">
                            <span>Em Desenvolvimento</span>
                        </div>
                        <div class="legenda-item">
                            <img src="icones/icones_legendas/nao_iniciada.png" alt="N√£o Iniciada">
                            <span>N√£o Iniciada</span>
                        </div>
                        <div class="legenda-item">
                            <img src="icones/icones_legendas/paralisado.png" alt="Paralisado">
                            <span>Paralisado</span>
                        </div>
                        <div class="legenda-item">
                            <img src="icones/icones_legendas/sem_evolucao.png" alt="Sem Evolu√ß√£o">
                            <span>Sem Evolu√ß√£o</span>
                        </div>
                        <div class="legenda-item">
                            <img src="icones/icones_legendas/cancelada.png" alt="Cancelada">
                            <span>Cancelada</span>
                        </div>
                    </div>

                    <div class="legenda-grupo">
                        <h4>EIXOS</h4>
                        <div class="legenda-item">
                            <img src="icones/icones_legendas/des_rural.png" alt="Rural">
                            <span>Desenvolvimento Rural</span>
                        </div>
                        <div class="legenda-item">
                            <img src="icones/icones_legendas/des_social.png" alt="Social">
                            <span>Desenvolvimento Social</span>
                        </div>
                        <div class="legenda-item">
                            <img src="icones/icones_legendas/des_economico.png" alt="Econ√¥mico">
                            <span>Desenvolvimento Econ√¥mico</span>
                        </div>
                        <div class="legenda-item">
                            <img src="icones/icones_legendas/educacao.png" alt="Educa√ß√£o">
                            <span>Educa√ß√£o</span>
                        </div>
                        <div class="legenda-item">
                            <img src="icones/icones_legendas/governadoria.png" alt="Governadoria">
                            <span>Governadoria</span>
                        </div>
                        <div class="legenda-item">
                            <img src="icones/icones_legendas/infraestrutura.png" alt="Infraestrutura">
                            <span>Infraestrutura</span>
                        </div>
                        <div class="legenda-item">
                            <img src="icones/icones_legendas/meio_ambiente.png" alt="Meio Ambiente">
                            <span>Meio Ambiente</span>
                        </div>
                        <div class="legenda-item">
                            <img src="icones/icones_legendas/saude.png" alt="Sa√∫de">
                            <span>Sa√∫de</span>
                        </div>
                        <div class="legenda-item">
                            <img src="icones/icones_legendas/seguranca.png" alt="Seguran√ßa">
                            <span>Seguran√ßa</span>
                        </div>
                    </div>
                </div>

                <div id="panel-sobre" class="panel-section">
                    <h3>Sobre a Plataforma</h3>
                    <p>O <strong>Mapa de Obras do Piau√≠</strong> √© uma ferramenta interativa desenvolvida para promover a transpar√™ncia e facilitar o monitoramento dos investimentos p√∫blicos no estado.</p>
                    <p style="margin-top: 10px;">Atrav√©s desta plataforma, o cidad√£o pode visualizar, de forma georreferenciada, a distribui√ß√£o das obras e interven√ß√µes de infraestrutura em todos os munic√≠pios piauienses.</p>
                    <h4 style="margin-top: 20px; color: #0352AA;">Nossos objetivos:</h4>
                    <ul class="lista-sobre">
                        <li><strong>üëÅÔ∏è Transpar√™ncia:</strong><br>Disponibilizar dados claros sobre valores, prazos e execu√ß√£o f√≠sica.</li>
                        <li><strong>üìà Monitoramento:</strong><br>Permitir o acompanhamento do status real de cada empreendimento (em andamento, conclu√≠do, paralisado).</li>
                        <li><strong>ü§ù Controle Social:</strong><br>Fornecer informa√ß√µes para que a sociedade participe ativamente da fiscaliza√ß√£o dos recursos p√∫blicos.</li>
                    </ul>
                </div>

            </div>
        </div>

        <div id="mobile-overlay" class="mobile-overlay"></div>

        <div class="map-wrapper">
            <iframe src="mapa_obras.html" frameborder="0" id="map-frame"></iframe>
            
            <div class="layer-switcher">
                <button id="btn-mapa" class="layer-btn active" onclick="mudarBase('mapa')">Mapa</button>
                <button id="btn-satelite" class="layer-btn" onclick="mudarBase('satelite')">Sat√©lite</button>
            </div>
        </div>
    </div>

    <script>
        const toggleBtn = document.getElementById('menu-toggle');
        const sidebarContainer = document.getElementById('sidebar-container');
        const mobileOverlay = document.getElementById('mobile-overlay'); // Captura o overlay
        const iconItems = document.querySelectorAll('.icon-item');
        const panels = document.querySelectorAll('.panel-section');

        // 1. Abrir/Fechar Menu Geral (Hamburguer)
        toggleBtn.addEventListener('click', () => {
            sidebarContainer.classList.toggle('closed');
        });

        // 2. Fechar Menu ao clicar no Overlay (S√≥ funciona no mobile via CSS)
        mobileOverlay.addEventListener('click', () => {
            sidebarContainer.classList.add('closed');
        });

        // 3. Trocar abas ao clicar nos √≠cones
        iconItems.forEach(item => {
            item.addEventListener('click', () => {
                // Remove ativo de todos
                iconItems.forEach(i => i.classList.remove('active'));
                panels.forEach(p => p.classList.remove('active'));

                // Ativa o clicado
                item.classList.add('active');
                const targetId = item.getAttribute('data-target');
                document.getElementById(targetId).classList.add('active');

                // Reseta o Scroll do painel para o topo
                document.querySelector('.content-panel').scrollTop = 0;

                // Se o menu estiver fechado, abre ele
                if(sidebarContainer.classList.contains('closed')) {
                    sidebarContainer.classList.remove('closed');
                }
            });
        });

        // =======================================================
        // 4. FUN√á√ÉO PARA INICIAR OS FILTROS (SLIM SELECT)
        // =======================================================
        
        window.selectsInstances = {}; 
        let tentativas = 0; 

        window.iniciarSlimSelect = function() {
            if (typeof SlimSelect === 'undefined') {
                tentativas++;
                if (tentativas > 50) { 
                    console.error("ERRO: SlimSelect n√£o carregou.");
                    return;
                }
                setTimeout(window.iniciarSlimSelect, 100);
                return;
            }

            // Configura√ß√µes personalizadas por campo
            const configs = {
                'filtro-municipio': { placeholder: 'Selecione os Munic√≠pios', searchPlaceholder: 'Buscar cidade...' },
                'filtro-territorio': { placeholder: 'Selecione os Territ√≥rios', searchPlaceholder: 'Buscar territ√≥rio...' },
                'filtro-eixo': { placeholder: 'Selecione o Eixo', searchPlaceholder: 'Buscar eixo...' },
                'filtro-orgao': { placeholder: 'Selecione o √ìrg√£o', searchPlaceholder: 'Buscar √≥rg√£o...' },
                'filtro-situacao': { placeholder: 'Selecione a Situa√ß√£o', searchPlaceholder: 'Buscar status...' },
                'filtro-classificacao': { placeholder: 'Selecione a Classifica√ß√£o', searchPlaceholder: 'Buscar classifica√ß√£o...' },
                'filtro-subclassificacao': { placeholder: 'Selecione a Sub-Classifica√ß√£o', searchPlaceholder: 'Buscar...' },
                'filtro-tipologia': { placeholder: 'Selecione a Tipologia', searchPlaceholder: 'Buscar tipo...' }
            };

            const ids = Object.keys(configs);

            ids.forEach(id => {
                if (window.selectsInstances[id]) {
                    window.selectsInstances[id].destroy();
                }

                try {
                    const el = document.getElementById(id);
                    if(el) {
                        const configTexto = configs[id];
                        window.selectsInstances[id] = new SlimSelect({
                            select: '#' + id,
                            placeholder: configTexto.placeholder,
                            searchPlaceholder: configTexto.searchPlaceholder,
                            searchText: 'Nenhum resultado encontrado',
                            closeOnSelect: false,
                            showSearch: true
                        });
                    }
                } catch (e) {
                    console.error("Erro ao criar filtro para " + id, e);
                }
            });
            console.log("Filtros visuais atualizados e traduzidos!");
        };

        // =======================================================
        // 5. FUN√á√ÉO PARA TROCAR O TIPO DE MAPA
        // =======================================================
        function mudarBase(tipo) {
            // Atualiza visual dos bot√µes
            document.querySelectorAll('.layer-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('btn-' + tipo).classList.add('active');

            // Manda o comando para o iframe
            const iframe = document.getElementById('map-frame');
            if (iframe && iframe.contentWindow && iframe.contentWindow.trocarCamadaBase) {
                iframe.contentWindow.trocarCamadaBase(tipo);
            } else {
                console.warn("Mapa ainda n√£o carregou ou fun√ß√£o n√£o encontrada.");
            }
        }
    </script>
</body>
</html>